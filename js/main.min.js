var permaDLex={},permaMLex={},permaTLex={},permaSLex={},prospLex={},affLex={},ageLex={},genderLex={},big5Lex={},lexStatus={dLoaded:!1,mLoaded:!1,tLoaded:!1,sLoaded:!1,pLoaded:!1,aLoaded:!1,gLoaded:!1,eLoaded:!1,"5Loaded":!1},body=document.getElementsByTagName("BODY")[0],prospectCheck=document.getElementById("prospectCheck"),affectCheck=document.getElementById("affectCheck"),optimismCheck=document.getElementById("optimismCheck"),bigFiveCheck=document.getElementById("bigFiveCheck"),ageCheck=document.getElementById("ageCheck"),
genderCheck=document.getElementById("genderCheck"),minWeight=document.getElementById("minWeight"),maxWeight=document.getElementById("maxWeight"),permaSelect=document.getElementById("permaSelect"),pieChart,radarChart,fiveChart,affChart;function indexesOf(d,c){for(var b=[],a=d.length;a--;)d[a]===c&&b.unshift(a);return b}function makeCSV(d){document.getElementById("alphaCheck").checked&&d.sort();for(var c="data:text/csv;charset=UTF-16LE,",b=d.length,a=0;a<b;a++)c+=d[a]+"\n";return encodeURI(c)}
function clearCanvases(){pieChart&&pieChart.destroy();radarChart&&radarChart.destroy();fiveChart&&fiveChart.destroy();affChart&&affChart.destroy();for(var d=document.getElementsByTagName("canvas"),c=d.length;c--;){var b=d[c].parentNode,a=document.createElement("canvas");a.id=d[c].id;a.width=400;a.height=400;a.style.width="400px";a.style.height="400px";b.removeChild(d[c]);b.appendChild(a)}}
function optToggle(){var d=document.getElementById("optBox");prospectCheck.checked&&affectCheck.checked?(optimismCheck.disabled=!1,d.classList.remove("disabled")):(optimismCheck.disabled=!0,optimismCheck.checked=!1,d.classList.add("disabled"))}function enableExtras(){prospectCheck.disabled=!1;affectCheck.disabled=!1;bigFiveCheck.disabled=!1;ageCheck.disabled=!1;genderCheck.disabled=!1}
function disableExtras(){prospectCheck.checked=!1;prospectCheck.disabled=!0;affectCheck.checked=!1;affectCheck.disabled=!0;optimismCheck.checked=!1;bigFiveCheck.checked=!1;bigFiveCheck.disabled=!0;ageCheck.checked=!1;ageCheck.disabled=!0;genderCheck.checked=!1;genderCheck.disabled=!0}function enableWeights(d,c){minWeight.disabled=!1;maxWeight.disabled=!1;minWeight.value=d;maxWeight.value=c;minWeight.min=d;maxWeight.max=c}function disableWeights(){minWeight.disabled=!0;maxWeight.disabled=!0}
function getNgrams(d,c){for(var b=[],a=function(a){for(var b=[],e=0;e<c;e++)b.push(d[a+c+(e-c)]);return b},e=d.length-c+1,f=0;f<e;f++)b.push(a(f));return b}function ngramConvert(d){for(var c=[],b=d.length,a=0;a<b;a++)c.push(d[a].join(" "));return c}
function loadLexicon(d,c,b){body.classList.add("loading");var a=new XMLHttpRequest;a.open("GET",d,!0);a.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);lexStatus[b]=!0;for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d])}else window.alert("There was an error loading the lexicon! Please refresh the page and try again.");body.classList.remove("loading")};a.onerror=function(){window.alert("There was an error loading the lexicon! Please refresh the page and try again.");
body.classList.remove("loading")};a.send()}
function tokenise(d){var c=new RegExp(/(?:(?:\+?[01][\-\s.]*)?(?:[\(]?\d{3}[\-\s.\)]*)?\d{3}[\-\s.]*\d{4})|(?:[<>]?[:;=8>][\-o\*\']?[\)\]\(\[dDpPxX\/\:\}\{@\|\\]|[\)\]\(\[dDpPxX\/\:\}\{@\|\\][\-o\*\']?[:;=8<][<>]?|<3|\(?\(?\#?\(?\(?\#?[>\-\^\*\+o\~][\_\.\|oO\,][<\-\^\*\+o\~][\#\;]?\)?\)?)|(?:(?:http[s]?\:\/\/)?(?:[\w\_\-]+\.)+(?:com|net|gov|edu|info|org|ly|be|gl|co|gs|pr|me|cc|us|gd|nl|ws|am|im|fm|kr|to|jp|sg))|(?:http[s]?\:\/\/)|(?:\[[a-z_]+\])|(?:\/\w+\?(?:\;?\w+\=\w+)+)|<[^>]+>|(?:@[\w_]+)|(?:\#+[\w_]+[\w\'_\-]*[\w_]+)|(?:[a-z][a-z'\-_]+[a-z])|(?:[+\-]?\d+[,\/.:-]\d+[+\-]?)|(?:[\w_]+)|(?:\.(?:\s*\.){1,})|(?:\S)/,"gi");
d=he.decode(d);return d.match(c)}
function sortMatches(d,c){var b={counts:{}},a=!1,e=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,g=permaSelect.value;if("1"===g||"4"===g)a=!0,e=parseFloat(minWeight.value),f=parseFloat(maxWeight.value);for(var h in c)if(c.hasOwnProperty(h)){g=h.startsWith("POS")||h.startsWith("NEG");var k=[],w=0,r=c[h],l;for(l in r)if(r.hasOwnProperty(l)&&-1<d.indexOf(l)){var p=r[l];if(!(g&&a&&(p<e||p>f))){var t=[],u=indexesOf(d,l).length;w+=u;if(1<u){for(var m=[],q=0;q<u;q++)m.push(l);t.push([m,p])}else t.push([l,
p]);k.push(t)}}b.counts[h]=w;b[h]=k}return b}function getWords(d,c){var b=[],a;for(a in d)if(d.hasOwnProperty(a)&&a.startsWith(c)&&"counts"!==a){var e=d[a],f;for(f in e)if(e.hasOwnProperty(f)){var g=e[f][0][0],h=0;Array.isArray(g)&&(h=g.length,g=e[f][0][0][0]);if(-1===b.indexOf(g))if(0===h)b.push(g);else for(var k=0;k<h;k++)b.push(g)}}return b}
function handleDuplicates(d){var c={},b;for(b in d)if(d.hasOwnProperty(b)&&"counts"!==b){var a=[],e=d[b],f;for(f in e)if(e.hasOwnProperty(f)){var g=e[f][0][0];Array.isArray(g)?a.push(g[0]+"["+g.length+"]"):a.push(g)}c[b]=a}return c}
function calcLex(d,c,b,a){if(!d)return null;c&&"number"!==typeof c&&(c=Number(c));b&&"number"!==typeof b&&(b=Number(b));b||(b=0);var e=0,f;for(f in d)if(d.hasOwnProperty(f)){var g=d[f][0][0],h=Number(d[f][0][1]),k=1;Array.isArray(g)&&(k=g.length);e="freq"===a?e+k/c*h:e+h}return e+b}
function main(){body.classList.add("loading");var d=document.getElementById("textInput").value.toString().trim().toLowerCase();if(0===d.length)body.classList.remove("loading"),window.alert("Input box is empty!");else{clearCanvases();var c=tokenise(d);d=d.replace(/\s+/gi," ").split(" ").length;var b=c.length;if(document.getElementById("CSVCheck").checked){var a=makeCSV(c),e=document.createElement("a");e.setAttribute("href",a);e.setAttribute("download","PPTA_Tokens_"+Date.now().toString()+".csv");e.click()}e=
document.getElementById("ngramSelect").value;if("1"===e||"2"===e)for(a=[],a.push(ngramConvert(getNgrams(c,2))),"1"===e&&a.push(ngramConvert(getNgrams(c,3))),e=0;e<a.length;e++)c=c.concat(a[e]);document.getElementById("incngram").checked&&(b=c.length);e=permaSelect.value;a="4"===e?sortMatches(c,permaSLex):"2"===e?sortMatches(c,permaMLex):"3"===e?sortMatches(c,permaTLex):sortMatches(c,permaDLex);a.counts.POS_T=getWords(a,"POS").length;a.counts.NEG_T=getWords(a,"NEG").length;a.counts.TOTAL=getWords(a,
"").length;var f=0,g=0,h=0,k=0,w=0,r=0,l=0,p=0,t=0,u=0;"4"===e&&(f=2.675173871,g=2.055179283,h=1.977389757,k=1.738298902,w=3.414517804,r=2.50468297,l=1.673629622,p=1.782788984,t=1.52890284,u=2.482131179);f=calcLex(a.POS_P,b,f,"binary");g=calcLex(a.POS_E,b,g,"binary");h=calcLex(a.POS_R,b,h,"binary");k=calcLex(a.POS_M,b,k,"binary");w=calcLex(a.POS_A,b,w,"binary");r=calcLex(a.NEG_P,b,r,"binary");l=calcLex(a.NEG_E,b,l,"binary");p=calcLex(a.NEG_R,b,p,"binary");t=calcLex(a.NEG_M,b,t,"binary");u=calcLex(a.NEG_A,
b,u,"binary");var m=handleDuplicates(a),q=document.getElementById("permaPie").getContext("2d"),x=document.getElementById("permaRad").getContext("2d"),M={labels:["Emotion","Engagement","Relationships","Meaning","Accomplishment"],datasets:[{label:"Positive",backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[f,g,h,k,w]},{label:"Negative",backgroundColor:"rgba(255,99,132,0.2)",
borderColor:"rgba(255,99,132,1)",pointBackgroundColor:"rgba(255,99,132,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(255,99,132,1)",data:[r,l,p,t,u]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]};pieChart=new Chart(q,{type:"pie",data:{labels:["Positive","Negative"],datasets:[{data:[a.counts.POS_T,
a.counts.NEG_T],backgroundColor:["#77dd77","#FF6384"],hoverBackgroundColor:["#77dd77","#FF6384"]}]}});radarChart=new Chart(x,{type:"radar",data:M});if(prospectCheck.checked){var n=sortMatches(c,prospLex);n.counts.TOTAL=getWords(n,"").length;var N=calcLex(n.PAST,b,-.649406376419,"binary");var O=calcLex(n.PRESENT,b,.236749577324,"binary");var P=calcLex(n.FUTURE,b,-.570547567181,"binary");var G=handleDuplicates(n)}if(affectCheck.checked){var F=sortMatches(c,affLex);var z=calcLex(F.AFFECT,b,5.037104721,
"binary");var A=calcLex(F.INTENSITY,b,2.399762631,"binary");var Q=handleDuplicates(F);9<z&&(z=9);9<A&&(A=9);1>z&&(z=1);1>A&&(A=1);q={datasets:[{label:"Affect / Intensity",data:[{x:z,y:A,r:5}],backgroundColor:"#FF6384",hoverBackgroundColor:"#FF6384"}]};x=document.getElementById("affBubble").getContext("2d");affChart=new Chart(x,{type:"bubble",data:q,options:{scales:{yAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,labelString:"Intensity"}}],xAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,
labelString:"Affect"}}]}}})}if(optimismCheck.checked){var C=getWords(n,"FUTURE");C=sortMatches(C,affLex);var R=calcLex(C.AFFECT,b,5.037104721,"binary"),S=handleDuplicates(C)}if(bigFiveCheck.checked){var v=sortMatches(c,big5Lex);v.counts.TOTAL=getWords(v,"").length;var B=calcLex(v.O,b,0,"binary");var I=calcLex(v.C,b,0,"binary");var J=calcLex(v.E,b,0,"binary");var K=calcLex(v.A,b,0,"binary");var L=calcLex(v.N,b,0,"binary");var D=handleDuplicates(v);q={labels:["Openness","Conscientiousness","Extraversion",
"Agreeableness","Neuroticism"],datasets:[{label:"Big Five Personality Traits",backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[B,I,J,K,L]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]};
x=document.getElementById("fiveRadar").getContext("2d");fiveChart=new Chart(x,{type:"radar",data:q})}if(ageCheck.checked){var H=sortMatches(c,ageLex);H=calcLex(H.AGE,b,23.2188604687,"freq").toFixed(2)}if(genderCheck.checked){var E=sortMatches(c,genderLex);E=calcLex(E.GENDER,b,-.06724152,"freq")}c=b-a.counts.TOTAL;q=(a.counts.TOTAL/b*100).toFixed(2);x=(c/b*100).toFixed(2);var y;0===a.counts.POS_T||0===a.counts.NEG_T?a.counts.POS_T<a.counts.NEG_T?y="Of the matches, 100% were negative PERMA matches.":
a.counts.POS_T>a.counts.NEG_T?y="Of the matches, 100% were positive PERMA matches.":a.counts.POS_T===a.counts.NEG_T&&(y="There were no PERMA matches in the input."):a.counts.POS_T<a.counts.NEG_T?y="For every positive PERMA match there are "+(a.counts.NEG_T/a.counts.POS_T).toFixed(3)+" times as many negative PERMA matches.":a.counts.POS_T>a.counts.NEG_T?y="For every negative PERMA match there are "+(a.counts.POS_T/a.counts.NEG_T).toFixed(3)+" times as many positive PERMA matches.":a.counts.POS_T===
a.counts.NEG_T&&(y="There are an equal number of + and - PERMA matches.");document.getElementById("wordcount").textContent=b;document.getElementById("truecount").textContent=d;document.getElementById("matches").textContent=a.counts.TOTAL+" ("+q+"%)";document.getElementById("pmatches").textContent=a.counts.POS_T;document.getElementById("nmatches").textContent=a.counts.NEG_T;document.getElementById("umatches").textContent=c+" ("+x+"%)";document.getElementById("ratio").textContent=y;"1"===e||"4"===e?
(document.getElementById("lex").classList.remove("hidden"),document.getElementById("ppl").textContent=f,document.getElementById("pel").textContent=g,document.getElementById("prl").textContent=h,document.getElementById("pml").textContent=k,document.getElementById("pal").textContent=w,document.getElementById("npl").textContent=r,document.getElementById("nel").textContent=l,document.getElementById("nrl").textContent=p,document.getElementById("nml").textContent=t,document.getElementById("nal").textContent=
u,document.getElementById("permaRadar").classList.remove("hidden")):(document.getElementById("lex").classList.add("hidden"),document.getElementById("permaRadar").classList.add("hidden"));document.getElementById("posP").textContent=m.POS_P.join(", ");document.getElementById("negP").textContent=m.NEG_P.join(", ");document.getElementById("posE").textContent=m.POS_E.join(", ");document.getElementById("negE").textContent=m.NEG_E.join(", ");document.getElementById("posR").textContent=m.POS_R.join(", ");
document.getElementById("negR").textContent=m.NEG_R.join(", ");document.getElementById("posM").textContent=m.POS_M.join(", ");document.getElementById("negM").textContent=m.NEG_M.join(", ");document.getElementById("posA").textContent=m.POS_A.join(", ");document.getElementById("negA").textContent=m.NEG_A.join(", ");prospectCheck.checked&&(document.getElementById("prospectRes").classList.remove("hidden"),document.getElementById("prospTotal").textContent=n.counts.TOTAL,document.getElementById("prospPast").textContent=
n.counts.PAST,document.getElementById("prospPresent").textContent=n.counts.PRESENT,document.getElementById("prospFuture").textContent=n.counts.FUTURE,document.getElementById("pastLex").textContent=N,document.getElementById("presLex").textContent=O,document.getElementById("futrLex").textContent=P,document.getElementById("past").textContent=G.PAST.join(", "),document.getElementById("present").textContent=G.PRESENT.join(", "),document.getElementById("future").textContent=G.FUTURE.join(", "));affectCheck.checked&&
(document.getElementById("affectRes").classList.remove("hidden"),document.getElementById("affTotal").textContent=F.counts.AFFECT,document.getElementById("affLex").textContent=z,document.getElementById("intLex").textContent=A,document.getElementById("affPrint").textContent=Q.AFFECT.join(", "));optimismCheck.checked&&(document.getElementById("optimRes").classList.remove("hidden"),document.getElementById("optTotal").textContent=C.counts.AFFECT,document.getElementById("optLex").textContent=R,document.getElementById("optPrint").textContent=
S.AFFECT.join(", "));bigFiveCheck.checked&&(document.getElementById("fiveRes").classList.remove("hidden"),document.getElementById("fiveTotal").textContent=v.counts.TOTAL,document.getElementById("oLex").textContent=B,document.getElementById("cLex").textContent=I,document.getElementById("eLex").textContent=J,document.getElementById("aLex").textContent=K,document.getElementById("nLex").textContent=L,document.getElementById("oPrint").textContent=D.O.join(", "),document.getElementById("cPrint").textContent=
D.C.join(", "),document.getElementById("ePrint").textContent=D.E.join(", "),document.getElementById("aPrint").textContent=D.A.join(", "),document.getElementById("nPrint").textContent=D.N.join(", "));ageCheck.checked&&(document.getElementById("ageRes").classList.remove("hidden"),document.getElementById("predAge").textContent=H);genderCheck.checked&&(document.getElementById("genRes").classList.remove("hidden"),B="Unknown",0>E?B="Male":0<E&&(B="Female"),document.getElementById("predGen").textContent=
B,document.getElementById("genLex").textContent=E);document.getElementById("noContent").classList.add("hidden");document.getElementById("outputSection").classList.remove("hidden");document.getElementById("inputSection").classList.remove("active");document.getElementById("results").classList.add("active");document.getElementById("iTab").classList.remove("active");document.getElementById("rTab").classList.add("active");body.classList.remove("loading");window.scrollTo(0,0)}}
document.addEventListener("DOMContentLoaded",function(){loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded");document.getElementById("startButton").addEventListener("click",main,!1);permaSelect.addEventListener("change",function(){var c=permaSelect.value;"1"===c?(!1===lexStatus.dLoaded&&loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded"),enableWeights(-.38,.86),enableExtras()):"2"===c?(!1===lexStatus.mLoaded&&loadLexicon("json/perma/permaV3_manual.json",permaMLex,"mLoaded"),disableWeights(),
enableExtras()):"3"===c?(!1===lexStatus.tLoaded&&loadLexicon("json/perma/permaV3_manual_tsp75.json",permaTLex,"tLoaded"),disableWeights(),enableExtras()):"4"===c?(!1===lexStatus.sLoaded&&loadLexicon("json/perma/dd_spermaV3.json",permaSLex,"sLoaded"),enableWeights(-.86,3.35),disableExtras()):(console.error("#permaSelect: invalid selection. Defaulting to 1."),permaSelect.value="1")},{passive:!0});prospectCheck.addEventListener("click",function(){prospectCheck.checked&&!1===lexStatus.pLoaded&&loadLexicon("json/prospection/prospection.json",
prospLex,"pLoaded");optToggle()},{passive:!0});affectCheck.addEventListener("click",function(){affectCheck.checked&&!1===lexStatus.aLoaded&&loadLexicon("json/affect/affect.json",affLex,"aLoaded");optToggle()},{passive:!0});ageCheck.addEventListener("click",function(){ageCheck.checked&&!1===lexStatus.eLoaded&&loadLexicon("json/age/age.json",ageLex,"eLoaded")},{passive:!0,once:!0});genderCheck.addEventListener("click",function(){genderCheck.checked&&!1===lexStatus.gLoaded&&loadLexicon("json/gender/gender.json",
genderLex,"gLoaded")},{passive:!0,once:!0});bigFiveCheck.addEventListener("click",function(){bigFiveCheck.checked&&!1===lexStatus["5Loaded"]&&loadLexicon("json/bigfive/bigfive.json",big5Lex,"5Loaded")},{passive:!0,once:!0});document.getElementById("CSVCheck").addEventListener("click",function(){var c=document.getElementById("alphaCSV"),b=document.getElementById("alphaCheck");c.classList.contains("disabled")?(c.classList.remove("disabled"),b.disabled=!1):(c.classList.add("disabled"),b.disabled=!0)},
{passive:!0});setTimeout(function(){$('[data-toggle="popover"]').popover();$(".collapse").collapse();$(".alert").alert()},100);if(navigator.userAgent.match(/IEMobile\/10\.0/)){var d=document.createElement("style");d.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}"));document.querySelector("head").appendChild(d)}},{passive:!0,once:!0});
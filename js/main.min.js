var permaDLex={},permaMLex={},permaTLex={},permaSLex={},prospLex={},affLex={},ageLex={},genderLex={},big5Lex={},lexStatus={dLoaded:!1,mLoaded:!1,tLoaded:!1,sLoaded:!1,pLoaded:!1,aLoaded:!1,gLoaded:!1,eLoaded:!1,"5Loaded":!1},body=document.getElementsByTagName("BODY")[0],prospectCheck=document.getElementById("prospectCheck"),affectCheck=document.getElementById("affectCheck"),optimismCheck=document.getElementById("optimismCheck"),bigFiveCheck=document.getElementById("bigFiveCheck"),ageCheck=document.getElementById("ageCheck"),
genderCheck=document.getElementById("genderCheck"),minWeight=document.getElementById("minWeight"),maxWeight=document.getElementById("maxWeight"),permaSelect=document.getElementById("permaSelect"),pieChart,radarChart,fiveChart,affChart;function indexesOf(a,e){for(var d=[],c=a.length;c--;)a[c]===e&&d.unshift(c);return d}function makeCSV(a){document.getElementById("alphaCheck").checked&&a.sort();for(var e="data:text/csv;charset=UTF-16LE,",d=a.length,c=0;c<d;c++)e+=a[c]+"\n";return encodeURI(e)}
function clearCanvases(){pieChart&&pieChart.destroy();radarChart&&radarChart.destroy();fiveChart&&fiveChart.destroy();affChart&&affChart.destroy();for(var a=document.getElementsByTagName("canvas"),e=a.length;e--;){var d=a[e].parentNode,c=document.createElement("canvas");c.id=a[e].id;c.width=400;c.height=400;c.style.width="400px";c.style.height="400px";d.removeChild(a[e]);d.appendChild(c)}}
function optToggle(){var a=document.getElementById("optBox");prospectCheck.checked&&affectCheck.checked?(optimismCheck.disabled=!1,a.classList.remove("disabled")):(optimismCheck.disabled=!0,optimismCheck.checked=!1,a.classList.add("disabled"))}function getNgrams(a,e){for(var d=[],c=function(d){for(var c=[],g=0;g<e;g++)c.push(a[d+e+(g-e)]);return c},l=a.length-e+1,g=0;g<l;g++)d.push(c(g));return d}function ngramConvert(a){for(var e=[],d=a.length,c=0;c<d;c++)e.push(a[c].join(" "));return e}
function loadLexicon(a,e,d){body.classList.add("loading");var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);lexStatus[d]=!0;for(var c in a)a.hasOwnProperty(c)&&(e[c]=a[c])}else window.alert("There was an error loading the lexicon! Please refresh the page and try again.");body.classList.remove("loading")};c.onerror=function(){window.alert("There was an error loading the lexicon! Please refresh the page and try again.");
body.classList.remove("loading")};c.send()}
function tokenise(a){return a.match(new RegExp(/(?:(?:\+?[01][\-\s.]*)?(?:[\(]?\d{3}[\-\s.\)]*)?\d{3}[\-\s.]*\d{4})|(?:[<>]?[:;=8>][\-o\*\']?[\)\]\(\[dDpPxX\/\:\}\{@\|\\]|[\)\]\(\[dDpPxX\/\:\}\{@\|\\][\-o\*\']?[:;=8<][<>]?|<3|\(?\(?\#?\(?\(?\#?[>\-\^\*\+o\~][\_\.\|oO\,][<\-\^\*\+o\~][\#\;]?\)?\)?)|(?:(?:http[s]?\:\/\/)?(?:[\w\_\-]+\.)+(?:com|net|gov|edu|info|org|ly|be|gl|co|gs|pr|me|cc|us|gd|nl|ws|am|im|fm|kr|to|jp|sg))|(?:http[s]?\:\/\/)|(?:\[[a-z_]+\])|(?:\/\w+\?(?:\;?\w+\=\w+)+)|<[^>]+>|(?:@[\w_]+)|(?:\#+[\w_]+[\w\'_\-]*[\w_]+)|(?:[a-z][a-z'\-_]+[a-z])|(?:[+\-]?\d+[,\/.:-]\d+[+\-]?)|(?:[\w_]+)|(?:\.(?:\s*\.){1,})|(?:\S)/,"gi"))}
function sortMatches(a,e){var d={counts:{}},c=!1,l=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,k=permaSelect.value;if("1"===k||"4"===k)c=!0,l=parseFloat(minWeight.value),g=parseFloat(maxWeight.value);for(var m in e)if(e.hasOwnProperty(m)){k=m.startsWith("POS")||m.startsWith("NEG");var p=[],u=0,v=e[m],h;for(h in v)if(v.hasOwnProperty(h)&&-1<a.indexOf(h)){var f=v[h];if(!(k&&c&&(f<l||f>g))){var b=[],n=indexesOf(a,h).length;u+=n;if(1<n){for(var r=[],q=0;q<n;q++)r.push(h);b.push([r,f])}else b.push([h,
f]);p.push(b)}}d.counts[m]=u;d[m]=p}return d}function getWords(a,e){var d=[],c;for(c in a)if(a.hasOwnProperty(c)&&c.startsWith(e)&&"counts"!==c){var l=a[c],g;for(g in l)if(l.hasOwnProperty(g)){var k=l[g][0][0],m=0;Array.isArray(k)&&(m=k.length,k=l[g][0][0][0]);if(-1===d.indexOf(k))if(0===m)d.push(k);else for(var p=0;p<m;p++)d.push(k)}}return d}
function handleDuplicates(a){var e={},d;for(d in a)if(a.hasOwnProperty(d)&&"counts"!==d){var c=[],l=a[d],g;for(g in l)if(l.hasOwnProperty(g)){var k=l[g][0][0];Array.isArray(k)?c.push(k[0]+"["+k.length+"]"):c.push(k)}e[d]=c}return e}
function calcLex(a,e,d,c){if(!a)return null;e&&"number"!==typeof e&&(e=Number(e));d&&"number"!==typeof d&&(d=Number(d));d||(d=0);var l=0,g;for(g in a)if(a.hasOwnProperty(g)){var k=a[g][0][0],m=Number(a[g][0][1]),p=1;Array.isArray(k)&&(p=k.length);l="freq"===c?l+p/e*m:l+m}return l+d}
function main(){var a,e,d,c,l,g,k,m,p,u;body.classList.add("loading");var v=document.getElementById("textInput").value.toString().trim().toLowerCase();if(0===v.length)return body.classList.remove("loading"),window.alert("Input box is empty!"),!1;clearCanvases();var h=tokenise(v);v=v.replace(/\s+/gi," ").split(" ").length;if(document.getElementById("CSVCheck").checked){var f=makeCSV(h),b=document.createElement("a");b.setAttribute("href",f);b.setAttribute("download","PPTA_Tokens_"+Date.now().toString()+
".csv");b.click()}f=h.length;var n=document.getElementById("ngramSelect").value;if("1"===n||"2"===n)for(b=[],b.push(ngramConvert(getNgrams(h,2))),"1"===n&&b.push(ngramConvert(getNgrams(h,3))),n=0;n<b.length;n++)h=h.concat(b[n]);document.getElementById("incngram").checked&&(f=h.length);n=permaSelect.value;b="4"===n?sortMatches(h,permaSLex):"2"===n?sortMatches(h,permaMLex):"3"===n?sortMatches(h,permaTLex):sortMatches(h,permaDLex);b.counts.POS_T=getWords(b,"POS").length;b.counts.NEG_T=getWords(b,"NEG").length;
b.counts.TOTAL=getWords(b,"").length;"4"===n?(a=2.675173871,e=2.055179283,d=1.977389757,c=1.738298902,l=3.414517804,g=2.50468297,k=1.673629622,m=1.782788984,p=1.52890284,u=2.482131179):(a=0,e=0,d=0,c=0,l=0,g=0,k=0,m=0,p=0,u=0);a=calcLex(b.POS_P,f,a,"binary");e=calcLex(b.POS_E,f,e,"binary");d=calcLex(b.POS_R,f,d,"binary");c=calcLex(b.POS_M,f,c,"binary");l=calcLex(b.POS_A,f,l,"binary");g=calcLex(b.NEG_P,f,g,"binary");k=calcLex(b.NEG_E,f,k,"binary");m=calcLex(b.NEG_R,f,m,"binary");p=calcLex(b.NEG_M,
f,p,"binary");u=calcLex(b.NEG_A,f,u,"binary");var r=handleDuplicates(b),q={};if(prospectCheck.checked){q=sortMatches(h,prospLex);q.counts.TOTAL=getWords(q,"").length;var C=calcLex(q.PAST,f,-.649406376419,"binary");var N=calcLex(q.PRESENT,f,.236749577324,"binary");var O=calcLex(q.FUTURE,f,-.570547567181,"binary");var F=handleDuplicates(q)}var D={};if(affectCheck.checked){D=sortMatches(h,affLex);var x=calcLex(D.AFFECT,f,5.037104721,"binary");var y=calcLex(D.INTENSITY,f,2.399762631,"binary");var P=handleDuplicates(D);
9<x&&(x=9);9<y&&(y=9);1>x&&(x=1);1>y&&(y=1);var t={datasets:[{label:"Affect / Intensity",data:[{x:x,y:y,r:5}],backgroundColor:"#FF6384",hoverBackgroundColor:"#FF6384"}]},z=document.getElementById("affBubble").getContext("2d");affChart=new Chart(z,{type:"bubble",data:t,options:{scales:{yAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,labelString:"Intensity"}}],xAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,labelString:"Affect"}}]}}})}z={};var H={};if(optimismCheck.checked){var G=
getWords(q,"FUTURE");z=sortMatches(G,affLex);H=calcLex(z.AFFECT,f,5.037104721,"binary");G=handleDuplicates(z)}t={};if(bigFiveCheck.checked){t=sortMatches(h,big5Lex);t.counts.TOTAL=getWords(t,"").length;var I=calcLex(t.O,f,0,"binary");var J=calcLex(t.C,f,0,"binary");var K=calcLex(t.E,f,0,"binary");var L=calcLex(t.A,f,0,"binary");var M=calcLex(t.N,f,0,"binary");var E=handleDuplicates(t);var A={labels:["Openness","Conscientiousness","Extraversion","Agreeableness","Neuroticism"],datasets:[{label:"Big Five Personality Traits",
backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[I,J,K,L,M]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]},B=document.getElementById("fiveRadar").getContext("2d");fiveChart=new Chart(B,
{type:"radar",data:A})}A={};ageCheck.checked&&(A=sortMatches(h,ageLex),A=calcLex(A.AGE,f,23.2188604687,"freq").toFixed(2));B={};genderCheck.checked&&(h=sortMatches(h,genderLex),B=calcLex(h.GENDER,f,-.06724152,"freq"));h=f-b.counts.TOTAL;var Q=(b.counts.TOTAL/f*100).toFixed(2),R=(h/f*100).toFixed(2),w=document.getElementById("permaPie").getContext("2d"),S=document.getElementById("permaRad").getContext("2d"),T={labels:["Emotion","Engagement","Relationships","Meaning","Accomplishment"],datasets:[{label:"Positive",
backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[a,e,d,c,l]},{label:"Negative",backgroundColor:"rgba(255,99,132,0.2)",borderColor:"rgba(255,99,132,1)",pointBackgroundColor:"rgba(255,99,132,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(255,99,132,1)",data:[g,k,m,p,u]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",
borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]};pieChart=new Chart(w,{type:"pie",data:{labels:["Positive","Negative"],datasets:[{data:[b.counts.POS_T,b.counts.NEG_T],backgroundColor:["#77dd77","#FF6384"],hoverBackgroundColor:["#77dd77","#FF6384"]}]}});radarChart=new Chart(S,{type:"radar",data:T});w="";0===b.counts.POS_T||0===b.counts.NEG_T?b.counts.POS_T<b.counts.NEG_T?w="Of the matches, 100% were negative PERMA matches.":
b.counts.POS_T>b.counts.NEG_T?w="Of the matches, 100% were positive PERMA matches.":b.counts.POS_T===b.counts.NEG_T&&(w="There were no PERMA matches in the input."):b.counts.POS_T<b.counts.NEG_T?w="For every positive PERMA match there are "+(b.counts.NEG_T/b.counts.POS_T).toFixed(3)+" times as many negative PERMA matches.":b.counts.POS_T>b.counts.NEG_T?w="For every negative PERMA match there are "+(b.counts.POS_T/b.counts.NEG_T).toFixed(3)+" times as many positive PERMA matches.":b.counts.POS_T===
b.counts.NEG_T&&(w="There are an equal number of + and - PERMA matches.");document.getElementById("wordcount").textContent=f;document.getElementById("truecount").textContent=v;document.getElementById("matches").textContent=b.counts.TOTAL+" ("+Q+"%)";document.getElementById("pmatches").textContent=b.counts.POS_T;document.getElementById("nmatches").textContent=b.counts.NEG_T;document.getElementById("umatches").textContent=h+" ("+R+"%)";document.getElementById("ratio").textContent=w;"1"===n||"4"===n?
(document.getElementById("lex").classList.remove("hidden"),document.getElementById("ppl").textContent=a,document.getElementById("pel").textContent=e,document.getElementById("prl").textContent=d,document.getElementById("pml").textContent=c,document.getElementById("pal").textContent=l,document.getElementById("npl").textContent=g,document.getElementById("nel").textContent=k,document.getElementById("nrl").textContent=m,document.getElementById("nml").textContent=p,document.getElementById("nal").textContent=
u,document.getElementById("permaRadar").classList.remove("hidden")):(document.getElementById("lex").classList.add("hidden"),document.getElementById("permaRadar").classList.add("hidden"));document.getElementById("posP").textContent=r.POS_P.join(", ");document.getElementById("negP").textContent=r.NEG_P.join(", ");document.getElementById("posE").textContent=r.POS_E.join(", ");document.getElementById("negE").textContent=r.NEG_E.join(", ");document.getElementById("posR").textContent=r.POS_R.join(", ");
document.getElementById("negR").textContent=r.NEG_R.join(", ");document.getElementById("posM").textContent=r.POS_M.join(", ");document.getElementById("negM").textContent=r.NEG_M.join(", ");document.getElementById("posA").textContent=r.POS_A.join(", ");document.getElementById("negA").textContent=r.NEG_A.join(", ");prospectCheck.checked&&(document.getElementById("prospectRes").classList.remove("hidden"),document.getElementById("prospTotal").textContent=q.counts.TOTAL,document.getElementById("prospPast").textContent=
q.counts.PAST,document.getElementById("prospPresent").textContent=q.counts.PRESENT,document.getElementById("prospFuture").textContent=q.counts.FUTURE,document.getElementById("pastLex").textContent=C,document.getElementById("presLex").textContent=N,document.getElementById("futrLex").textContent=O,document.getElementById("past").textContent=F.PAST.join(", "),document.getElementById("present").textContent=F.PRESENT.join(", "),document.getElementById("future").textContent=F.FUTURE.join(", "));affectCheck.checked&&
(document.getElementById("affectRes").classList.remove("hidden"),document.getElementById("affTotal").textContent=D.counts.AFFECT,document.getElementById("affLex").textContent=x,document.getElementById("intLex").textContent=y,document.getElementById("affPrint").textContent=P.AFFECT.join(", "));optimismCheck.checked&&(document.getElementById("optimRes").classList.remove("hidden"),document.getElementById("optTotal").textContent=z.counts.AFFECT,document.getElementById("optLex").textContent=H,document.getElementById("optPrint").textContent=
G.AFFECT.join(", "));ageCheck.checked&&(document.getElementById("ageRes").classList.remove("hidden"),document.getElementById("predAge").textContent=A);genderCheck.checked&&(document.getElementById("genRes").classList.remove("hidden"),C="Unknown",0>B?C="Male":0<B&&(C="Female"),document.getElementById("predGen").textContent=C,document.getElementById("genLex").textContent=B);bigFiveCheck.checked&&(document.getElementById("fiveRes").classList.remove("hidden"),document.getElementById("fiveTotal").textContent=
t.counts.TOTAL,document.getElementById("oLex").textContent=I,document.getElementById("cLex").textContent=J,document.getElementById("eLex").textContent=K,document.getElementById("aLex").textContent=L,document.getElementById("nLex").textContent=M,document.getElementById("oPrint").textContent=E.O.join(", "),document.getElementById("cPrint").textContent=E.C.join(", "),document.getElementById("ePrint").textContent=E.E.join(", "),document.getElementById("aPrint").textContent=E.A.join(", "),document.getElementById("nPrint").textContent=
E.N.join(", "));document.getElementById("noContent").classList.add("hidden");document.getElementById("outputSection").classList.remove("hidden");document.getElementById("results").classList.add("active");document.getElementById("inputSection").classList.remove("active");document.getElementById("rTab").classList.add("active");document.getElementById("iTab").classList.remove("active");body.classList.remove("loading");window.scrollTo(0,0)}
document.addEventListener("DOMContentLoaded",function(){loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded");document.getElementById("startButton").addEventListener("click",main,!1);setTimeout(function(){$('[data-toggle="popover"]').popover();$(".collapse").collapse();$(".alert").alert()},600);permaSelect.addEventListener("change",function(){var a=permaSelect.value;"1"===a?(!1===lexStatus.dLoaded&&loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded"),minWeight.disabled=!1,maxWeight.disabled=
!1,minWeight.value=-.38,maxWeight.value=.86,minWeight.min=-.38,maxWeight.max=.86):"2"===a?(!1===lexStatus.mLoaded&&loadLexicon("json/perma/permaV3_manual.json",permaMLex,"mLoaded"),minWeight.disabled=!0,maxWeight.disabled=!0):"3"===a?(!1===lexStatus.tLoaded&&loadLexicon("json/perma/permaV3_manual_tsp75.json",permaTLex,"tLoaded"),minWeight.disabled=!0,maxWeight.disabled=!0):"4"===a?(!1===lexStatus.sLoaded&&loadLexicon("json/perma/dd_spermaV3.json",permaSLex,"sLoaded"),minWeight.disabled=!1,maxWeight.disabled=
!1,minWeight.value=-.86,maxWeight.value=3.35,minWeight.min=-.86,maxWeight.max=3.35):(console.error("#permaSelect: invalid selection. Defaulting to 1."),permaSelect.value="1")},{passive:!0});prospectCheck.addEventListener("click",function(){prospectCheck.checked&&!1===lexStatus.pLoaded&&loadLexicon("json/prospection/prospection.json",prospLex,"pLoaded");optToggle()},{passive:!0});affectCheck.addEventListener("click",function(){affectCheck.checked&&!1===lexStatus.aLoaded&&loadLexicon("json/affect/affect.json",
affLex,"aLoaded");optToggle()},{passive:!0});document.getElementById("CSVCheck").addEventListener("click",function(){var a=document.getElementById("alphaCSV"),d=document.getElementById("alphaCheck");a.classList.contains("disabled")?(a.classList.remove("disabled"),d.disabled=!1):(a.classList.add("disabled"),d.disabled=!0)},{passive:!0});ageCheck.addEventListener("click",function(){ageCheck.checked&&!1===lexStatus.eLoaded&&loadLexicon("json/age/age.json",ageLex,"eLoaded")},{passive:!0,once:!0});genderCheck.addEventListener("click",
function(){genderCheck.checked&&!1===lexStatus.gLoaded&&loadLexicon("json/gender/gender.json",genderLex,"gLoaded")},{passive:!0,once:!0});bigFiveCheck.addEventListener("click",function(){bigFiveCheck.checked&&!1===lexStatus["5Loaded"]&&loadLexicon("json/bigfive/bigfive.json",big5Lex,"5Loaded")},{passive:!0,once:!0});if(navigator.userAgent.match(/IEMobile\/10\.0/)){var a=document.createElement("style");a.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}"));document.querySelector("head").appendChild(a)}Chart.defaults.global.responsive=
!1;Chart.defaults.global.maintainAspectRatio=!1},{passive:!0,once:!0});
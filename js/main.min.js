var permaDLex={},permaMLex={},permaTLex={},permaSLex={},prospLex={},affLex={},ageLex={},genderLex={},big5Lex={},lexStatus={dLoaded:!1,mLoaded:!1,tLoaded:!1,sLoaded:!1,pLoaded:!1,aLoaded:!1,gLoaded:!1,eLoaded:!1,"5Loaded":!1},body=document.getElementsByTagName("body")[0],prospectCheck=document.getElementById("prospectCheck"),affectCheck=document.getElementById("affectCheck"),optimismCheck=document.getElementById("optimismCheck"),bigFiveCheck=document.getElementById("bigFiveCheck"),ageCheck=document.getElementById("ageCheck"),
genderCheck=document.getElementById("genderCheck"),minWeight=document.getElementById("minWeight"),maxWeight=document.getElementById("maxWeight"),permaSelect=document.getElementById("permaSelect"),pieChart,radarChart,fiveChart,affChart;function indexesOf(a,e){for(var c=[],d=a.length;d--;)a[d]===e&&c.unshift(d);return c}function makeCSV(a){document.getElementById("alphaCheck").checked&&a.sort();var e="data:text/csv;charset=UTF-16LE,",c=0,d=a.length;for(c;c<d;c++)e+=a[c]+"\n";return encodeURI(e)}
function clearCanvases(){null!=pieChart&&pieChart.destroy();null!=radarChart&&radarChart.destroy();null!=fiveChart&&fiveChart.destroy();null!=affChart&&affChart.destroy();for(var a=document.getElementsByTagName("canvas"),e=a.length;e--;){var c=a[e].parentNode,d=document.createElement("canvas");d.id=a[e].id;d.width=400;d.height=400;d.style.width="400px";d.style.height="400px";c.removeChild(a[e]);c.appendChild(d)}}
function optToggle(){var a=document.getElementById("optBox");prospectCheck.checked&&affectCheck.checked?(optimismCheck.disabled=!1,a.classList.remove("disabled")):(optimismCheck.disabled=!0,optimismCheck.checked=!1,a.classList.add("disabled"))}function getNgrams(a,e){--e;var c=[],d=function(c){var d=[],g=0,k=e+1;for(g;g<k;g++)d.push(a[c+e+(g-e)]);return d},g=0,k=a.length-e;for(g;g<k;g++)c.push(d(g));return c}
function ngramConvert(a){var e=0,c=a.length,d=[];for(e;e<c;e++)d.push(a[e].join(" "));return d}
function loadLexicon(a,e,c){body.classList.add("loading");var d=new XMLHttpRequest;d.open("GET",a,!0);d.onload=function(){if(200<=this.status&&400>this.status){var a=JSON.parse(this.response);lexStatus[c]=!0;for(var d in a)a.hasOwnProperty(d)&&(e[d]=a[d])}else window.alert("There was an error loading the lexicon! Please refresh the page and try again.");body.classList.remove("loading")};d.onerror=function(){window.alert("There was an error loading the lexicon! Please refresh the page and try again.");body.classList.remove("loading")};
d.send()}
function tokenise(a){return a.match(new RegExp(/(?:(?:\+?[01][\-\s.]*)?(?:[\(]?\d{3}[\-\s.\)]*)?\d{3}[\-\s.]*\d{4})|(?:[<>]?[:;=8>][\-o\*\']?[\)\]\(\[dDpPxX\/\:\}\{@\|\\]|[\)\]\(\[dDpPxX\/\:\}\{@\|\\][\-o\*\']?[:;=8<][<>]?|<3|\(?\(?\#?\(?\(?\#?[>\-\^\*\+o\~][\_\.\|oO\,][<\-\^\*\+o\~][\#\;]?\)?\)?)|(?:(?:http[s]?\:\/\/)?(?:[\w\_\-]+\.)+(?:com|net|gov|edu|info|org|ly|be|gl|co|gs|pr|me|cc|us|gd|nl|ws|am|im|fm|kr|to|jp|sg))|(?:http[s]?\:\/\/)|(?:\[[a-z_]+\])|(?:\/\w+\?(?:\;?\w+\=\w+)+)|<[^>]+>|(?:@[\w_]+)|(?:\#+[\w_]+[\w\'_\-]*[\w_]+)|(?:[a-z][a-z'\-_]+[a-z])|(?:[+\-]?\d+[,\/.:-]\d+[+\-]?)|(?:[\w_]+)|(?:\.(?:\s*\.){1,})|(?:\S)/,"gi"))}
function sortMatches(a,e){var c={counts:{}},d=!1,g=-999,k=999,h=permaSelect.value;if("1"===h||"4"===h)d=!0,g=parseFloat(minWeight.value),k=parseFloat(maxWeight.value);for(var n in e)if(e.hasOwnProperty(n)){h=[];var m,t=e[n],w=n.startsWith("POS")||n.startsWith("NEG"),l=0;for(m in t)if(t.hasOwnProperty(m)){var f=t[m];if(-1<a.indexOf(m)&&!(w&&d&&(f<g||f>k))){var b=[],u=indexesOf(a,m).length;l+=u;if(1<u){var q=[],p;for(p=0;p<u;p++)q.push(m);b.push([q,f])}else b.push([m,f]);h.push(b)}}c.counts[n]=l;c[n]=
h}return c}function getWords(a,e){var c=[],d;for(d in a)if(a.hasOwnProperty(d)&&d.startsWith(e)&&"counts"!==d){var g,k=a[d];for(g in k)if(k.hasOwnProperty(g)){var h=k[g][0][0],n=0;Array.isArray(h)&&(n=h.length,h=k[g][0][0][0]);if(-1===c.indexOf(h))if(0===n)c.push(h);else{var m;for(m=0;m<n;m++)c.push(h)}}}return c}
function handleDuplicates(a){var e={},c;for(c in a)if(a.hasOwnProperty(c)&&"counts"!==c){var d=[],g,k=a[c];for(g in k)if(k.hasOwnProperty(g)){var h=k[g][0][0];Array.isArray(h)?d.push(h[0]+"["+h.length+"]"):d.push(h)}e[c]=d}return e}
function calcLex(a,e,c,d){if(null==a)return null;null!=e&&"number"!==typeof e&&(e=Number(e));null!=c&&"number"!==typeof c&&(c=Number(c));null==c&&(c=0);var g=0,k;for(k in a)if(a.hasOwnProperty(k)){var h=a[k][0][0],n=Number(a[k][0][1]),m=1;Array.isArray(h)&&(m=h.length);g="freq"===d?g+m/e*n:g+n}return g+c}
function main(){var a,e,c,d,g,k,h,n,m,t;body.classList.add("loading");var w=document.getElementById("textInput").value.toString().trim().toLowerCase();if(0===w.length)return body.classList.remove("loading"),window.alert("Input box is empty!"),!1;clearCanvases();var l=tokenise(w);w=w.replace(/\s+/gi," ").split(" ").length;if(document.getElementById("CSVCheck").checked){var f=makeCSV(l),b=document.createElement("a");b.setAttribute("href",f);b.setAttribute("download","PPTA_Tokens_"+Date.now().toString()+
".csv");b.click()}b=document.getElementById("ngramSelect").value;if("1"===b||"2"===b)for(f=[],"1"===b?(f.push(ngramConvert(getNgrams(l,2))),f.push(ngramConvert(getNgrams(l,3)))):"2"===b&&f.push(ngramConvert(getNgrams(l,2))),b=0;b<f.length;b++)l=l.concat(f[b]);f=l.length;var u=permaSelect.value;b="4"===u?sortMatches(l,permaSLex):"2"===u?sortMatches(l,permaMLex):"3"===u?sortMatches(l,permaTLex):sortMatches(l,permaDLex);b.counts.POS_T=getWords(b,"POS").length;b.counts.NEG_T=getWords(b,"NEG").length;
b.counts.TOTAL=getWords(b,"").length;"4"===u?(a=2.675173871,e=2.055179283,c=1.977389757,d=1.738298902,g=3.414517804,k=2.50468297,h=1.673629622,n=1.782788984,m=1.52890284,t=2.482131179):(a=0,e=0,c=0,d=0,g=0,k=0,h=0,n=0,m=0,t=0);a=calcLex(b.POS_P,f,a,"binary").toFixed(6);e=calcLex(b.POS_E,f,e,"binary").toFixed(6);c=calcLex(b.POS_R,f,c,"binary").toFixed(6);d=calcLex(b.POS_M,f,d,"binary").toFixed(6);g=calcLex(b.POS_A,f,g,"binary").toFixed(6);k=calcLex(b.NEG_P,f,k,"binary").toFixed(6);h=calcLex(b.NEG_E,
f,h,"binary").toFixed(6);n=calcLex(b.NEG_R,f,n,"binary").toFixed(6);m=calcLex(b.NEG_M,f,m,"binary").toFixed(6);t=calcLex(b.NEG_A,f,t,"binary").toFixed(6);var q=handleDuplicates(b),p={};if(prospectCheck.checked){p=sortMatches(l,prospLex);p.counts.TOTAL=getWords(p,"").length;var C=calcLex(p.PAST,f,-.649406376419,"binary").toFixed(6);var N=calcLex(p.PRESENT,f,.236749577324,"binary").toFixed(6);var O=calcLex(p.FUTURE,f,-.570547567181,"binary").toFixed(6);var F=handleDuplicates(p)}var D={};if(affectCheck.checked){D=
sortMatches(l,affLex);var x=calcLex(D.AFFECT,f,5.037104721,"binary").toFixed(3);var y=calcLex(D.INTENSITY,f,2.399762631,"binary").toFixed(3);var P=handleDuplicates(D);9<x&&(x=9);9<y&&(y=9);1>x&&(x=1);1>y&&(y=1);var r={datasets:[{label:"Affect / Intensity",data:[{x:x,y:y,r:5}],backgroundColor:"#FF6384",hoverBackgroundColor:"#FF6384"}]},z=document.getElementById("affBubble").getContext("2d");affChart=new Chart(z,{type:"bubble",data:r,options:{scales:{yAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,
labelString:"Intensity"}}],xAxes:[{ticks:{max:9,min:1,stepSize:1},scaleLabel:{display:!0,labelString:"Affect"}}]}}})}z={};var H={};if(optimismCheck.checked){var G=getWords(p,"FUTURE");z=sortMatches(G,affLex);H=calcLex(z.AFFECT,f,5.037104721,"binary").toFixed(3);G=handleDuplicates(z)}r={};if(bigFiveCheck.checked){r=sortMatches(l,big5Lex);r.counts.TOTAL=getWords(r,"").length;var I=calcLex(r.O,f,0,"binary").toFixed(6);var J=calcLex(r.C,f,0,"binary").toFixed(6);var K=calcLex(r.E,f,0,"binary").toFixed(6);
var L=calcLex(r.A,f,0,"binary").toFixed(6);var M=calcLex(r.N,f,0,"binary").toFixed(6);var E=handleDuplicates(r);var A={labels:["Openness","Conscientiousness","Extraversion","Agreeableness","Neuroticism"],datasets:[{label:"Big Five Personality Traits",backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[I,J,K,L,M]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",
borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]},B=document.getElementById("fiveRadar").getContext("2d");fiveChart=new Chart(B,{type:"radar",data:A})}A={};ageCheck.checked&&(A=sortMatches(l,ageLex),A=calcLex(A.AGE,f,23.2188604687,"freq").toFixed(2));B={};genderCheck.checked&&(l=sortMatches(l,genderLex),B=calcLex(l.GENDER,f,-.06724152,"freq").toFixed(3));l=f-b.counts.TOTAL;var Q=(b.counts.TOTAL/
f*100).toFixed(2),R=(l/f*100).toFixed(2),v=document.getElementById("permaPie").getContext("2d"),S=document.getElementById("permaRad").getContext("2d"),T={labels:["Emotion","Engagement","Relationships","Meaning","Accomplishment"],datasets:[{label:"Positive",backgroundColor:"rgba(119, 221, 119,0.2)",borderColor:"#77dd77",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#77dd77",data:[a,e,c,d,g]},{label:"Negative",backgroundColor:"rgba(255,99,132,0.2)",
borderColor:"rgba(255,99,132,1)",pointBackgroundColor:"rgba(255,99,132,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(255,99,132,1)",data:[k,h,n,m,t]},{label:"Zero",backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"#000",pointBackgroundColor:"rgba(0,0,0,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"#000",data:[0,0,0,0,0]}]};pieChart=new Chart(v,{type:"pie",data:{labels:["Positive","Negative"],datasets:[{data:[b.counts.POS_T,
b.counts.NEG_T],backgroundColor:["#77dd77","#FF6384"],hoverBackgroundColor:["#77dd77","#FF6384"]}]}});radarChart=new Chart(S,{type:"radar",data:T});v="";0===b.counts.POS_T||0===b.counts.NEG_T?b.counts.POS_T<b.counts.NEG_T?v="Of the matches, 100% were negative PERMA matches.":b.counts.POS_T>b.counts.NEG_T?v="Of the matches, 100% were positive PERMA matches.":b.counts.POS_T===b.counts.NEG_T&&(v="There were no PERMA matches in the input."):b.counts.POS_T<b.counts.NEG_T?v="For every positive PERMA match there are "+
(b.counts.NEG_T/b.counts.POS_T).toFixed(3)+" times as many negative PERMA matches.":b.counts.POS_T>b.counts.NEG_T?v="For every negative PERMA match there are "+(b.counts.POS_T/b.counts.NEG_T).toFixed(3)+" times as many positive PERMA matches.":b.counts.POS_T===b.counts.NEG_T&&(v="There are an equal number of + and - PERMA matches.");document.getElementById("wordcount").textContent=f;document.getElementById("truecount").textContent=w;document.getElementById("matches").textContent=b.counts.TOTAL+" ("+
Q+"%)";document.getElementById("pmatches").textContent=b.counts.POS_T;document.getElementById("nmatches").textContent=b.counts.NEG_T;document.getElementById("umatches").textContent=l+" ("+R+"%)";document.getElementById("ratio").textContent=v;"1"===u||"4"===u?(document.getElementById("lex").classList.remove("hidden"),document.getElementById("ppl").textContent=a,document.getElementById("pel").textContent=e,document.getElementById("prl").textContent=c,document.getElementById("pml").textContent=d,document.getElementById("pal").textContent=
g,document.getElementById("npl").textContent=k,document.getElementById("nel").textContent=h,document.getElementById("nrl").textContent=n,document.getElementById("nml").textContent=m,document.getElementById("nal").textContent=t,document.getElementById("permaRadar").classList.remove("hidden")):(document.getElementById("lex").classList.add("hidden"),document.getElementById("permaRadar").classList.add("hidden"));document.getElementById("posP").textContent=q.POS_P.join(", ");document.getElementById("negP").textContent=
q.NEG_P.join(", ");document.getElementById("posE").textContent=q.POS_E.join(", ");document.getElementById("negE").textContent=q.NEG_E.join(", ");document.getElementById("posR").textContent=q.POS_R.join(", ");document.getElementById("negR").textContent=q.NEG_R.join(", ");document.getElementById("posM").textContent=q.POS_M.join(", ");document.getElementById("negM").textContent=q.NEG_M.join(", ");document.getElementById("posA").textContent=q.POS_A.join(", ");document.getElementById("negA").textContent=
q.NEG_A.join(", ");prospectCheck.checked&&(document.getElementById("prospectRes").classList.remove("hidden"),document.getElementById("prospTotal").textContent=p.counts.TOTAL,document.getElementById("prospPast").textContent=p.counts.PAST,document.getElementById("prospPresent").textContent=p.counts.PRESENT,document.getElementById("prospFuture").textContent=p.counts.FUTURE,document.getElementById("pastLex").textContent=C,document.getElementById("presLex").textContent=N,document.getElementById("futrLex").textContent=
O,document.getElementById("past").textContent=F.PAST.join(", "),document.getElementById("present").textContent=F.PRESENT.join(", "),document.getElementById("future").textContent=F.FUTURE.join(", "));affectCheck.checked&&(document.getElementById("affectRes").classList.remove("hidden"),document.getElementById("affTotal").textContent=D.counts.AFFECT,document.getElementById("affLex").textContent=x,document.getElementById("intLex").textContent=y,document.getElementById("affPrint").textContent=P.AFFECT.join(", "));
optimismCheck.checked&&(document.getElementById("optimRes").classList.remove("hidden"),document.getElementById("optTotal").textContent=z.counts.AFFECT,document.getElementById("optLex").textContent=H,document.getElementById("optPrint").textContent=G.AFFECT.join(", "));ageCheck.checked&&(document.getElementById("ageRes").classList.remove("hidden"),document.getElementById("predAge").textContent=A);genderCheck.checked&&(document.getElementById("genRes").classList.remove("hidden"),C="Unknown",0>B?C="Male":
0<B&&(C="Female"),document.getElementById("predGen").textContent=C,document.getElementById("genLex").textContent=B);bigFiveCheck.checked&&(document.getElementById("fiveRes").classList.remove("hidden"),document.getElementById("fiveTotal").textContent=r.counts.TOTAL,document.getElementById("oLex").textContent=I,document.getElementById("cLex").textContent=J,document.getElementById("eLex").textContent=K,document.getElementById("aLex").textContent=L,document.getElementById("nLex").textContent=M,document.getElementById("oPrint").textContent=
E.O.join(", "),document.getElementById("cPrint").textContent=E.C.join(", "),document.getElementById("ePrint").textContent=E.E.join(", "),document.getElementById("aPrint").textContent=E.A.join(", "),document.getElementById("nPrint").textContent=E.N.join(", "));document.getElementById("noContent").classList.add("hidden");document.getElementById("outputSection").classList.remove("hidden");document.getElementById("results").classList.add("active");document.getElementById("inputSection").classList.remove("active");
document.getElementById("rTab").classList.add("active");document.getElementById("iTab").classList.remove("active");body.classList.remove("loading");window.scrollTo(0,0)}
document.addEventListener("DOMContentLoaded",function(){loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded");document.getElementById("startButton").addEventListener("click",main,!1);permaSelect.addEventListener("change",function(){var a=permaSelect.value;"1"===a?(!1===lexStatus.dLoaded&&loadLexicon("json/perma/permaV3_dd.json",permaDLex,"dLoaded"),minWeight.disabled=!1,maxWeight.disabled=!1,minWeight.value=-.38,maxWeight.value=.86,minWeight.min=-.38,maxWeight.max=.86):"2"===a?(!1===lexStatus.mLoaded&&
loadLexicon("json/perma/permaV3_manual.json",permaMLex,"mLoaded"),minWeight.disabled=!0,maxWeight.disabled=!0):"3"===a?(!1===lexStatus.tLoaded&&loadLexicon("json/perma/permaV3_manual_tsp75.json",permaTLex,"tLoaded"),minWeight.disabled=!0,maxWeight.disabled=!0):"4"===a?(!1===lexStatus.sLoaded&&loadLexicon("json/perma/dd_spermaV3.json",permaSLex,"sLoaded"),minWeight.disabled=!1,maxWeight.disabled=!1,minWeight.value=-.86,maxWeight.value=3.35,minWeight.min=-.86,maxWeight.max=3.35):(console.error("#permaSelect: invalid selection. Defaulting to 1."),
permaSelect.value="1")},{passive:!0});prospectCheck.addEventListener("click",function(){prospectCheck.checked&&!1===lexStatus.pLoaded&&loadLexicon("json/prospection/prospection.json",prospLex,"pLoaded");optToggle()},{passive:!0});affectCheck.addEventListener("click",function(){affectCheck.checked&&!1===lexStatus.aLoaded&&loadLexicon("json/affect/affect.json",affLex,"aLoaded");optToggle()},{passive:!0});document.getElementById("CSVCheck").addEventListener("click",function(){var a=document.getElementById("alphaCSV"),
c=document.getElementById("alphaCheck");a.classList.contains("disabled")?(a.classList.remove("disabled"),c.disabled=!1):(a.classList.add("disabled"),c.disabled=!0)},{passive:!0});ageCheck.addEventListener("click",function(){ageCheck.checked&&!1===lexStatus.eLoaded&&loadLexicon("json/age/age.json",ageLex,"eLoaded")},{passive:!0,once:!0});genderCheck.addEventListener("click",function(){genderCheck.checked&&!1===lexStatus.gLoaded&&loadLexicon("json/gender/gender.json",genderLex,"gLoaded")},{passive:!0,
once:!0});bigFiveCheck.addEventListener("click",function(){bigFiveCheck.checked&&!1===lexStatus["5Loaded"]&&loadLexicon("json/bigfive/bigfive.json",big5Lex,"5Loaded")},{passive:!0,once:!0});setTimeout(function(){$('[data-toggle="popover"]').popover();$(".collapse").collapse();$(".alert").alert()},600);if(navigator.userAgent.match(/IEMobile\/10\.0/)){var a=document.createElement("style");a.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}"));document.querySelector("head").appendChild(a)}Chart.defaults.global.responsive=
!1;Chart.defaults.global.maintainAspectRatio=!1},{passive:!0,once:!0});